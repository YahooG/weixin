<!DOCTYPE html>
<html>



<head>
  <meta charset="utf-8">
  <title></title>

  <link media="screen" rel="stylesheet" href="/stylesheets/colorbox.css" />
  <link href="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    li {
      list-style: none;

    }

    .clearfix::after {
      content: "";
      display: block;
      clear: both;
    }

    .adminTop {
      width: 100%;
      height: 58px;
      line-height: 58px;
      padding: 0 20px;
      background: #00E3E3;
    }

    .logoLeft {
      float: left;
      color: #fff;
      font-size: 14px;
    }

    .logoLeft span {
      float: left;
      text-align: center;
      display: block;
      width: 48px;
      height: 48px;
      line-height: 48px;
      border: 1px solid #fff;
      border-radius: 50%;
    }

    .logoRight li a {
      text-decoration: none;
      color: #fff;
      font-size: 14px;
    }

    .logoRight {
      float: right;
    }

    .logoRight ul li {
      float: right;
      padding: 0 20px;
      float: left;
      cursor: pointer;
    }

    .adminC {
      width: 100%;
    }

    .cLeft {
      width: 20%;
      height: auto;
      float: left;
      background: #4F4F4F;

    }

    .cLeft li {
      width: 100%;
      height: 40px;
      line-height: 40px;
      text-align: center;
      border: 1px solid #000;
      border-top: none;
    }

    .cLeft ul li a {
      color: #FFF;
      text-decoration: none;
      font-size: 14px;
    }

    .cRight {
      width: 70%;
      float: left;
      padding-left: 25px;
    }

    .cRight div {
      width: 100%;
      height: 58px;
      border: 1px solid gray;
      line-height: 58px;
    }

    .cRight input {
      width: 155px;
      height: 35px;
      line-height: 35px;
      margin-left: 25px;
    }

    .cRight button {
      width: 45px;
      height: 25px;
      line-height: 25px;
    }

    .banXin {
      width: 1120px;
      margin: 0 auto;

    }

    .update {
      width: 980px;
      height: auto;
    }
  </style>
</head>

<body>
  <div class="adminTop clearfix">
    <div class="logoLeft">
      <span>LOGO</span>
      &nbsp;&nbsp;&nbsp;&nbsp;立伟人力资源后台管理中心
    </div>
    <div class="logoRight">
      <ul>
        <li>
          <a href="#">用户:admin</a>
        </li>
        <li>
          <a href="#">系统首页</a>
        </li>
        <li>
          <a href="#">刷新</a>
        </li>
        <li>
          <a href="#">清除缓存</a>
        </li>
        <li>
          <a href="#">设置</a>
        </li>
        <li>
          <a href="#">退出</a>
        </li>
      </ul>
    </div>

  </div>
  <div class="adminC clearfix banXin">
    <div class="cLeft">
      <ul>
        <li>
          <a href="#">用户管理</a>
        </li>
        <li>
          <a href="#">新闻管理</a>
        </li>
      </ul>
    </div>
    <div class="cRight">
      <div>
        <input class="searchC" type="text" name="" value="" placeholder="请输入用户身份证号">
        <button class="search" type="button" name="button">搜索</button>
      </div>

      <table class="text-center table table-striped table-bordered  table-hover table-condensed">
        <tr class="lei">
          <th>姓名</th>
          <th>性别</th>
          <th>年龄</th>
          <th>手机号</th>
          <th>身份证号</th>
          <td></td>
          <td></td>
        </tr>

        <%if(userLIst){%>

          <%for (var i=0;i<userLIst.length;i++){%>
            <tr class="info">
              <td>
                <%=userLIst[i].name%>
              </td>
              <td>
                <%=userLIst[i].sex%>
              </td>
              <td>
                <%=userLIst[i].age%>
              </td>
              <td>
                <%=userLIst[i].phone%>
              </td>
              <td>
                <%=userLIst[i].cardId%>
              </td>
              <td>
                <button class="xiuGai">修改</button>
              </td>
              <td>
                <button class="shanChu">删除</button>
              </td>
            </tr>
            <%}%>
              <%}%>

      </table>
      <!-- 登陆 -->
      <div class="update" id="dialog-login" title="修改用户信息界面">
        <div class="form-group">
          <label for="exampleInputEmail1">name</label>
          <input class="name" type="text" class="form-control" id="exampleInputEmail1" placeholder="name" name="name">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Password</label>
          <input class="pwd" type="password" class="form-control" id="exampleInputPassword1" placeholder="Password" name="password">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">wechat</label>
          <input class="wechat" type="text" class="form-control" id="exampleInputPassword1" placeholder="wechat" name="passwordAgin">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">phone</label>
          <input class="phone" type="text" class="form-control" id="exampleInputPassword1" placeholder="phone" name="password">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">cardId</label>
          <input class="card" type="text" class="form-control" id="exampleInputPassword1" placeholder="card" name="password">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">sex</label>
          <input class="sex" type="text" class="form-control" id="exampleInputPassword1" placeholder="sex" name="password">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1"></label>type</label>
          <input class="type" type="text" class="form-control" id="exampleInputPassword1" placeholder="type" name="password">
        </div>

        <button id="submit" type="submit" class="btn btn-success">提交</button>

      </div>


    </div>

  </div>
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="/js/jquery.colorbox.js" type="text/javascript"></script>
  </span>
  <script type="text/javascript">



    $(function () {
      var changeNode = null;
      var card = $(".card").get(0);
      var search = $(".search");
      var searchC = $(".searchC")
      search.click(function () {
        var cardId = searchC.val();
        if (!cardId) {
          alert("查询内容不能为空");
          return;
        } else {
          $.ajax({
            method: "post",
            url: '/admin/searchUser',
            data: { cardId: cardId },
          }).done(function (msg) {
            console.log(msg);   //获取到用户数据
          }).fail(function (jqXhr, textStatus) {
            console.log("requesterror" + textStatus);
            console.error('search error');
          })
        }
      })
      card.setAttribute("readonly", "readonly")


      document.addEventListener('click', function (event) {
        let title = event.target.innerText;
        changeNode = event.target;

        if (title === '修改') {
          changeNode = event.target;
          cardId = $(event.target).parent().parent().children()[4]

          showLogin();
        }

        if (title === '删除') {
          var cardId = $(event.target).parent().parent().children()[4].innerText;
          $.ajax({
            method: "post",
            url: "/admin/deleteUser",
            data: { cardId: cardId }
          }).done(function (msg) {
            if (msg === 'ok') {
              $(event.target).parent().parent().remove();
            } else {
              alert('删除失败');
            }
          }).fail(function (jqXhr, textStatus) {
            console.log("request error" + textStatus);
            alert('删除失败');
          });
        }
      }, false);


      $("#dialog-login").dialog({
        autoOpen: false,
        height: 300,
        width: 350,
        modal: true,
      });


      function showLogin() {
        $("#dialog-login").dialog("open");
      }
      var submit = $("#submit");
      submit.click(function (event) {
        var name = $(".name").val();
        var pwd = $(".pwd").val();
        var weixin = $(".wechat").val();
        var phone = $(".phone").val();
        var card = cardId.innerText;
        var sex = $(".sex").val();

        if (!name || !pwd || !weixin || !phone || !card || !sex) {
          alert("不允许设置为空值")
          return;
        } else {
          $.ajax({
            method: "post",
            url: "/admin/updateUser",
            data: { name: name, pwd: pwd, weixin: weixin, phone: phone, cardId: card, sex: sex }
          }).done(function (msg) {
            if (msg === 'ok') {
              if (changeNode) {
                // console.log($(changeNode).parent().parent());
                window.location.reload();
              }
              alert('更新成功');
            } else {
              alert('更新错误');
            }
          }).fail(function (jqXhr, textStatus) {
            console.log("request error" + textStatus);
          });
        }

      });
      // var shanChu = $(".shanChu");
      // shanChu.click(function () {
      //   var cardId = shanChu.parent().siblings().hasClass("card");
      //   console.log('cardId');

      // });
      // console.log(event.target.parentNode)

    });

  </script>
</body>

</html>